<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="dynamic-side-nav">
  <template>
    <style>
      :host {
        display: block;
      }

      button {
        border: none;
        padding: 0;
        background: none;
        font-size: 0;
      }

      svg, img {
        width: var(--img-width, 2rem); /* IE11 needs fixed width for svg */
        height: var(--img-height, 2rem); /* IE11 needs fixed height for svg */
      }

      svg[hidden], img[hidden], path[hidden] {
        display: none;
      }

      svg > g {
        stroke: var(--img-color, rgba(0, 0, 0, 0.87)); /* https://material.io/ - Text and background colors */
        stroke-linecap: var(--img-linecap, square);
      }

      #overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: var(--overlay-background-color, rgba(0, 0, 0, 0.4));

        z-index: var(--side-nav-z-index, 0);
      }

      #contentContainer {
        background-color: var(--content-background-color, #fff);
        box-shadow: var(--content-box-shadow,
          calc(calc(1rem / 13) * 4) 0 calc(calc(1rem / 13) * 12) 0 rgba(0, 0, 0, 0.4));

        min-width: var(--content-min-width, 1rem);
        max-width: var(--content-max-width, initial);
      }
    </style>

    <button on-click="_onClickOpenButton">
      <img id="customImageOpen" src="[[imageOpen]]" alt="" hidden>

      <svg id="defaultImage" viewBox="0 0 80 80">
        <g stroke-width="16">
          <path id="defaultImageOpen" d="m 8 8 h 64 m 0 32 h -64 m 0 32 h 64" />
          <path id="defaultImageClose" hidden d="m 12 12 l 56 56 m 0 -56 l -56 56" /> <!-- stroke-linecap="square" is bigger then round -->
        </g>
      </svg>
    </button>

    <div id="overlay" on-click="_onClickOverlay">
      <div id="contentContainer">
        <slot></slot>
      </div>
    </div>
  </template>

  <script>
    /**
     * `dynamic-side-nav`
     * dynamic side nav
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class DynamicSideNav extends Polymer.Element {
      static get is() { return 'dynamic-side-nav'; }
      static get properties() {
        return {
          imageOpen: {
            type: String,
            value: "",
            observer: '_imageOpenChanged'
          }
        };
      }

      constructor() {
        super();
      }

      _imageOpenChanged() {
        if (this.imageOpen) {
          this.$.customImageOpen.removeAttribute("hidden");
          this.$.defaultImage.setAttribute("hidden", true);
        }
      }

      _onClickOpenButton() {
        var overlay = this.$.overlay;
        var contentContainer = this.$.contentContainer;

        // 'display = "flex"' triggers transition, so first 'transition = 0'
        contentContainer.style.transition = "0";
        overlay.style.display = "flex";

        // Parent element can't have 'display: none;', else offsetWidth is 0
        contentContainer.style.marginLeft = 0 - contentContainer.offsetWidth + "px";

        window.setTimeout(function () {
          contentContainer.style.transition = "0.3s";
          contentContainer.style.marginLeft = "0";
        }, 0);

        // switch button
        if (!this.imageOpen) {
          this.$.defaultImageOpen.setAttribute("hidden", true);
          this.$.defaultImageClose.removeAttribute("hidden");
        }
      }

      _onClickOverlay(e) {
        //
        if (e.target.id !== "overlay")
          return;

        var overlay = this.$.overlay;
        var contentContainer = this.$.contentContainer;

        // add event listener
        contentContainer.addEventListener("transitionend", afterMarginLeft);

        // triggers transition
        contentContainer.style.marginLeft = 0 - contentContainer.offsetWidth + "px";

        // transitionend
        function afterMarginLeft() {
          overlay.style.display = "none";
          contentContainer.removeEventListener("transitionend", afterMarginLeft);
        }

        // switch button
        if (!this.imageOpen) {
          this.$.defaultImageClose.setAttribute("hidden", true);
          this.$.defaultImageOpen.removeAttribute("hidden");
        }
      }
    }

    window.customElements.define(DynamicSideNav.is, DynamicSideNav);
  </script>
</dom-module>
